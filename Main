local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Critical Fantasy | Float & Auto Orb",
   LoadingTitle = "Đang khởi tạo hệ thống bay...",
   LoadingSubtitle = "by Gemini AI",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false
})

_G.AutoOrb = false
local TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local orbContainer = workspace.MapComponents:FindFirstChild("OrbContainer_Client")

local MainTab = Window:CreateTab("Main", 4483362458)
local SettingsTab = Window:CreateTab("Settings", 4483362458)

-- Hàm di chuyển và giữ nhân vật lơ lửng
local function tweenTo(targetCFrame)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local root = player.Character.HumanoidRootPart
        
        -- Tạo điểm đứng phía trên Orb 5-7 studs để tránh quái đánh dưới đất
        local floatOffset = CFrame.new(0, 7, 0) 
        local targetPos = targetCFrame * floatOffset
        
        local distance = (root.Position - targetPos.Position).Magnitude
        local info = TweenInfo.new(distance / 200, Enum.EasingStyle.Linear)
        
        -- Vô hiệu hóa trọng lực tạm thời để không bị rơi khi bay
        root.Anchored = true 
        
        local tween = TweenService:Create(root, info, {CFrame = targetPos})
        tween:Play()
        return tween
    end
end

MainTab:CreateToggle({
   Name = "Auto Orb (Float Mode)",
   CurrentValue = false,
   Flag = "OrbToggle",
   Callback = function(Value)
      _G.AutoOrb = Value
      local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
      
      if Value then
          task.spawn(function()
              while _G.AutoOrb do
                  task.wait(0.1)
                  local container = workspace.MapComponents:FindFirstChild("OrbContainer_Client")
                  
                  if container then
                      local orbs = container:GetDescendants()
                      for _, orb in pairs(orbs) do
                          if orb:IsA("BasePart") and _G.AutoOrb then
                              local t = tweenTo(orb.CFrame)
                              if t then 
                                  t.Completed:Wait() 
                                  -- Giữ nhân vật ở đó 0.2 giây để game nhận Orb rồi mới bay tiếp
                                  task.wait(0.2) 
                              end
                          end
                      end
                  end
              end
              -- Trả lại trạng thái bình thường khi tắt Toggle
              if root then root.Anchored = false end
          end)
      else
          if root then root.Anchored = false end
      end
   end,
})

SettingsTab:CreateButton({
   Name = "Destroy UI",
   Callback = function()
      _G.AutoOrb = false
      local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
      if root then root.Anchored = false end
      Rayfield:Destroy()
   end,
})

Rayfield:LoadConfiguration()
