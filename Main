local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Critical Fantasy | Stable Float",
   LoadingTitle = "Đang tối ưu độ cao...",
   LoadingSubtitle = "by Gemini AI",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false
})

_G.AutoOrb = false
local TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local orbContainer = workspace.MapComponents:FindFirstChild("OrbContainer_Client")

local MainTab = Window:CreateTab("Main", 4483362458)
local SettingsTab = Window:CreateTab("Settings", 4483362458)

-- Hàm di chuyển giữ độ cao ổn định
local function tweenTo(orbPart)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local root = player.Character.HumanoidRootPart
        
        -- LẤY TỌA ĐỘ: X và Z của Orb, nhưng Y (độ cao) sẽ được tính toán
        -- Chúng ta lấy độ cao của Orb và cộng thêm một khoảng nhỏ để đảm bảo nhân vật ở TRÊN Orb
        -- Nếu Orb quá thấp, nhân vật vẫn sẽ ở độ cao an toàn.
        local targetX = orbPart.Position.X
        local targetZ = orbPart.Position.Z
        local targetY = orbPart.Position.Y + 5 -- Luôn cao hơn Orb 5 studs để né quái
        
        local targetCFrame = CFrame.new(targetX, targetY, targetZ)
        
        local distance = (root.Position - targetCFrame.Position).Magnitude
        local info = TweenInfo.new(distance / 200, Enum.EasingStyle.Linear)
        
        root.Anchored = true 
        local tween = TweenService:Create(root, info, {CFrame = targetCFrame})
        tween:Play()
        return tween
    end
end

MainTab:CreateToggle({
   Name = "Auto Orb (Fixed Height)",
   CurrentValue = false,
   Flag = "OrbToggle",
   Callback = function(Value)
      _G.AutoOrb = Value
      local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
      
      if Value then
          task.spawn(function()
              while _G.AutoOrb do
                  task.wait(0.05)
                  local container = workspace.MapComponents:FindFirstChild("OrbContainer_Client")
                  
                  if container then
                      for _, orb in pairs(container:GetDescendants()) do
                          if orb:IsA("BasePart") and _G.AutoOrb then
                              -- Truyền cả Part vào hàm để lấy Position chính xác
                              local t = tweenTo(orb)
                              if t then 
                                  t.Completed:Wait() 
                                  task.wait(0.1) 
                              end
                          end
                      end
                  end
              end
              if root then root.Anchored = false end
          end)
      else
          if root then root.Anchored = false end
      end
   end,
})

SettingsTab:CreateButton({
   Name = "Destroy UI",
   Callback = function()
      _G.AutoOrb = false
      local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
      if root then root.Anchored = false end
      Rayfield:Destroy()
   end,
})

Rayfield:LoadConfiguration()
